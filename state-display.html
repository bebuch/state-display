<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<dom-module id="state-display">
  <template strip-whitespace>
    <style>
      /* shadow DOM styles go here */
      :host {
        display: block;
      }
    </style>

    <canvas style="vertical-align:middle;" id="canvas"></canvas>
    <span style="vertical-align:middle;padding-left:0.5em;"><slot></slot></span>
  </template>

  <script>
    class StateDisplay extends Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element) {
      static get is() {
        return 'state-display';
      }

      static get properties() {
        return {
          state: {
            type: String,
            value: 'white',
            reflectToAttribute: true,
            observer: '_draw'
          },
        };
      }

      constructor() {
        super();
      }

      ready(){
        super.ready();

        this.addEventListener('iron-resize', this._resize);
      }

      _draw(){
        const ctx = this.$.canvas.getContext('2d');
        const size = this.$.canvas.width;

        let color = function(state){
            switch(state){
              case 'white':  return '#eeeeee';
              case 'green':  return '#33ff33';
              case 'yellow': return '#ffdd00';
              case 'red':    return '#ff0000';
              default:
                throw "state-display: invalid state property '" + state + "',"
					+ " valid values are: 'white', 'green', 'yellow' and 'red'";
            }
          }(this.state);

        let mid = size / 2;
        let cirle_size = 0.40 * size;

        let grd = ctx.createRadialGradient(mid, mid, cirle_size, mid, mid, 0);
        grd.addColorStop(0.0, color);
        grd.addColorStop(0.1, color);
        grd.addColorStop(1.0, "#fff");
        ctx.fillStyle = grd;
        ctx.shadowBlur = 0.08 * size;
        ctx.shadowColor = color;
        ctx.strokeStyle = '#000';

        ctx.beginPath();
        ctx.arc(mid, mid, cirle_size, 0, 2 * Math.PI);
        ctx.fill();
        ctx.stroke();
      }

      _resize(){
        let size = parseFloat(getComputedStyle(this.$.canvas).lineHeight);
        this.$.canvas.width = size;
        this.$.canvas.height = size;

        this._draw();
      }
    }
    customElements.define(StateDisplay.is, StateDisplay);
  </script>
</dom-module>
